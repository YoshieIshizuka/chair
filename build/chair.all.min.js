/*! chair 2013-04-26 */
var AjaxDataSource,AllRowSelectedStatus,AllRowUnselectedStatus,ArrayDataSource,Column,ColumnFormat,DomainEvent,DomainRegistry,Grid,GridColumnUpdated,GridRepository,GridRowAppended,GridRowRemoved,GridRowSelected,GridRowUnselected,GridService,Row,RowRepositoryInterface,RowSelectionService,Table,ViewController,__indexOf=[].indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(e in this&&this[e]===t)return e;return-1},__hasProp={}.hasOwnProperty;AllRowSelectedStatus=function(){function t(){this.unselectedRows=[]}return t.prototype.select=function(t){var e;return __indexOf.call(this.unselectedRows,t)>=0?(e=this.unselectedRows.indexOf(t),this.unselectedRows.splice(e,1)):void 0},t.prototype.unselect=function(t){return 0>__indexOf.call(this.unselectedRows,t)?this.unselectedRows.push(t):void 0},t}(),AllRowUnselectedStatus=function(){function t(){this.selectedRows=[]}return t.prototype.select=function(t){return 0>__indexOf.call(this.selectedRows,t)?this.selectedRows.push(t):void 0},t.prototype.unselect=function(t){var e;return __indexOf.call(this.selectedRows,t)>=0?(e=this.selectedRows.indexOf(t),this.selectedRows.splice(e,1)):void 0},t}(),Column=function(){function t(t,e,r){null==r&&(r=[]),this.id=t,this.name=e,this.formats=r}return t.prototype.format=function(t){var e,r,i,o;for(t=this.escapeHTML(t),o=this.formats,r=0,i=o.length;i>r;r++)e=o[r],t=e.format(t);return t},t.prototype.escapeHTML=function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},t}(),ColumnFormat=function(){function t(t){this.formatter=t}return t.prototype.format=function(t){return this.formatter(t)},t}(),GridColumnUpdated=function(){function t(t,e,r,i){this.gridId=t,this.rowId=e,this.columnId=r,this.columnValue=i}return t.prototype.serialize=function(){return{gridId:this.gridId,rowId:this.rowId,columnId:this.columnId,columnValue:this.columnValue}},t}(),DomainEvent={channels:[],publish:function(t,e){var r,i,o,n,s;for(void 0===this.channels[t]&&(this.channels[t]=[]),n=this.channels[t],s=[],i=0,o=n.length;o>i;i++)r=n[i],s.push(r(e.serialize(),t));return s},subscribe:function(t,e){return void 0===this.channels[t]&&(this.channels[t]=[]),this.channels[t].push(e)}},DomainRegistry={_gridRepository:null,rowSelectionService:function(){return new RowSelectionService},gridRepository:function(){return null===this._gridRepository&&(this._gridRepository=new GridRepository),this._gridRepository}},Grid=function(){function t(t,e){var r,i,o;for(this.id=t,this._rows={},this.columns=[],i=0,o=e.length;o>i;i++)r=e[i],this.columns.push(r)}return t.prototype.append=function(t){if(this._hasRow(t.id))throw Error("Row(id:"+t.id+") already exists in the Grid(id:"+this.id+")");return this._addRow(t)},t.prototype.updateColumn=function(t,e,r){return this._hasRow(t)?this._getRow(t).updateColumn(e,r,this.id):void 0},t.prototype.rows=function(){var t,e;return function(){var r,i;r=this._rows,i=[];for(t in r)__hasProp.call(r,t)&&(e=r[t],i.push(e));return i}.call(this)},t.prototype.removeRow=function(t){return this._hasRow(t)?(this._getRow(t).remove(),delete this._rows[t]):void 0},t.prototype._hasRow=function(t){return this._rows[t]?!0:!1},t.prototype._getRow=function(t){return this._rows[t]},t.prototype._addRow=function(t){return this._rows[t.id]=t,t.gridId=this.id,DomainEvent.publish("GridRowAppended",new GridRowAppended(this.id,t.id,t.columns))},t}(),GridRepository=function(){function t(t){var e,r,i;for(null==t&&(t=[]),this.grids={},r=0,i=t.length;i>r;r++)e=t[r],this.add(e)}return t.prototype.gridOfId=function(t,e){return this.grids[t]?e(null,this.grids[t]):(e(null,null),void 0)},t.prototype.add=function(t){return this.grids[t.id]=t},t}(),GridRowAppended=function(){function t(t,e,r){var i,o;this.gridId=t,this.rowId=e,this.columns=[];for(i in r)o=r[i],this.columns.push(o)}return t.prototype.serialize=function(){return{gridId:this.gridId,rowId:this.rowId,columns:this.columns}},t}(),GridRowRemoved=function(){function t(t,e){if(this.gridId=t,this.rowId=e,!this.gridId)throw Error("no grid id specified");if(!this.rowId)throw Error("no row id specified")}return t.prototype.serialize=function(){return{gridId:this.gridId,rowId:this.rowId}},t}(),GridRowSelected=function(){function t(t,e){if(this.gridId=t,this.rowId=e,!this.gridId)throw Error("no grid id specified");if(!this.rowId)throw Error("no row id specified")}return t.prototype.serialize=function(){return{gridId:this.gridId,rowId:this.rowId}},t}(),GridRowUnselected=function(){function t(t,e){if(this.gridId=t,this.rowId=e,!this.gridId)throw Error("no grid id specified");if(!this.rowId)throw Error("no row id specified")}return t.prototype.serialize=function(){return{gridId:this.gridId,rowId:this.rowId}},t}(),Row=function(){function t(t,e){var r,i;this.id=t,this.columns={};for(r in e)__hasProp.call(e,r)&&(i=e[r],this.columns[r]=""+i);this.deleted=!1,this.gridId=null}return t.prototype.updateColumn=function(t,e){return this.columns[t]?(this.columns[t]=e,DomainEvent.publish("GridColumnUpdated",new GridColumnUpdated(this.gridId,this.id,t,e))):void 0},t.prototype.remove=function(){return this.deleted=!0,DomainEvent.publish("GridRowRemoved",new GridRowRemoved(this.gridId,this.id))},t}(),RowRepositoryInterface=function(){function t(){}return t.prototype.rowOfId=function(t,e){throw null==e&&(e=function(){}),"This method should be implemented by subclass"},t}(),RowSelectionService=function(){function t(){}return t.prototype.gridSelectionStatuses=[],t.prototype.selectAll=function(t){return this.gridSelectionStatuses[t]=new AllRowSelectedStatus,DomainRegistry.gridRepository().gridOfId(t,function(e,r){var i,o,n,s,d;if(e)throw Error(e);if(null!==r){for(s=r.rows(),d=[],o=0,n=s.length;n>o;o++)i=s[o],d.push(DomainEvent.publish("GridRowSelected",new GridRowSelected(t,i.id)));return d}})},t.prototype.unselectAll=function(t){if(!this.gridSelectionStatuses[t])throw Error("Invalid status transition");return this.gridSelectionStatuses[t]=new AllRowUnselectedStatus,DomainRegistry.gridRepository().gridOfId(t,function(e,r){var i,o,n,s,d;if(e)throw Error(e);if(null!==r){for(s=r.rows(),d=[],o=0,n=s.length;n>o;o++)i=s[o],d.push(DomainEvent.publish("GridRowUnselected",new GridRowUnselected(t,i.id)));return d}})},t.prototype.select=function(t,e){return this.gridSelectionStatuses[t]||(this.gridSelectionStatuses[t]=new AllRowUnselectedStatus),this.gridSelectionStatuses[t].select(e),DomainEvent.publish("GridRowSelected",new GridRowSelected(t,e))},t.prototype.unselect=function(t,e){if(!this.gridSelectionStatuses[t])throw Error("Invalid status transition");return this.gridSelectionStatuses[t].unselect(e),DomainEvent.publish("GridRowUnselected",new GridRowUnselected(t,e))},t}(),GridService=function(){function t(){}return t.prototype.select=function(t,e){return DomainRegistry.rowSelectionService().select(t,e)},t.prototype.unselect=function(t,e){return DomainRegistry.rowSelectionService().unselect(t,e)},t.prototype.selectAll=function(t){return DomainRegistry.rowSelectionService().selectAll(t)},t.prototype.unselectAll=function(t){return DomainRegistry.rowSelectionService().unselectAll(t)},t.prototype.updateColumn=function(t,e,r,i){return DomainRegistry.gridRepository().gridOfId(t,function(t,o){if(t)throw Error(t);if(null!==o)return o.updateColumn(e,r,i)})},t.prototype.removeRow=function(t,e){return DomainRegistry.gridRepository().gridOfId(t,function(t,r){if(t)throw Error(t);if(null!==r)return r.removeRow(e)})},t}(),Table=function(){function t(t){this.table=t,this.rows={},this.rowsById={},this.numberOfRows=0}return t.prototype.header=function(t){var e,r,i,o,n,s;for(this.columns=t,r=$("<tr></tr>"),n=this.columns,s=[],i=0,o=n.length;o>i;i++)e=n[i],r.append($("<th></th>").append($("<span></span>").append(e))),s.push(this.table.find("thead").append(r));return s},t.prototype.get=function(t){return this.rows[t]},t.prototype.getById=function(t){return this.rowsById[t]},t.prototype.removeById=function(t){var e;return this.findRow(t).remove,e=this.getById(t),delete this.rowsById[t],e},t.prototype.updateById=function(t,e){var r,i,o,n,s,d;for(i=$("<tr></tr>").attr("data-id",t),o=$(this.table).find("tr[data-id="+t+"]"),this.getById(t=e),r=0,s=0,d=e.length;d>s;s++)n=e[s],i.append(this.createRowColumn(this.columns[r],n)),r++;return o.html(i.html())},t.prototype.insert=function(t,e){var r,i,o,n,s;for(void 0===e&&(e=this.guid()),i=$("<tr></tr>").attr("data-id",e),this.rows[this.numberOfRows++]=t,this.rowsById[e]=t,r=0,n=0,s=t.length;s>n;n++)o=t[n],i.append(this.createRowColumn(this.columns[r],o)),r++;return this.table.find("tbody").append(i)},t.prototype.createRowColumn=function(t,e){return $("<td></td>").addClass(t).append($("<span></span>").append(e))},t.prototype.addClassToRow=function(t,e){var r;return r=this.findRow(t),r.hasClass(e)?void 0:r.addClass(e)},t.prototype.removeClassFromRow=function(t,e){return this.findRow(t).removeClass(e)},t.prototype.removeAllClassesFromRow=function(t){var e;return e=this.findRow(t),e.removeClass()},t.prototype.toggleClassToRow=function(t,e){return this.findRow(t).toggleClass(e)},t.prototype.hasClassOfRow=function(t,e){return this.findRow(t).hasClass(e)},t.prototype.findRow=function(t){return $(this.table).find("tr[data-id="+t+"]")},t.prototype.listen=function(t,e,r){return this.findRow(t).on(e,function(){return r(t,$(this))})},t.prototype.listenRowEvent=function(t,e){return this.table.on(t,"tr",function(){var t;return t=$(this).attr("data-id"),e(t,$(this))})},t.prototype.listenTextEvent=function(t,e){return this.table.find("span").on(t,function(){var t;return t=$(this).parents("tr").attr("data-id"),e(t,$(this)),!1})},t.prototype.s4=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},t.prototype.guid=function(){return this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()},t}(),AjaxDataSource=function(){function t(t){this.url=t}return t.prototype.retrieve=function(t,e){return $.get(this.url,e,function(e){return t(e)})},t}(),ArrayDataSource=function(){function t(){}return t.prototype.retrieve=function(t){return t([["suin",26],["reoring",300],["nouphet",3e5]])},t}(),ViewController=function(){function t(t,e,r,i){var o=this;this.grid=t,this.tableSelector=e,this.header=r,this.rowSelectedClass=null!=i?i:"row_selected",this.table=new Table($(this.tableSelector)),this.applicationGridService=new GridService,this.table.header(r),this.table.listenRowEvent("click",function(t){return o.table.hasClassOfRow(t,o.rowSelectedClass)?o.applicationGridService.unselect(o.tableSelector,t):o.applicationGridService.select(o.tableSelector,t)}),DomainEvent.subscribe("GridRowAppended",function(t){return o.table.insert(t.columns,t.rowId)}),DomainEvent.subscribe("GridRowSelected",function(t){return o.table.addClassToRow(t.rowId,o.rowSelectedClass)}),DomainEvent.subscribe("GridRowUnselected",function(t){return o.table.removeClassFromRow(t.rowId,o.rowSelectedClass)})}return t.prototype.add=function(t,e){return this.grid.append(new Row(t,e))},t.prototype.selectAll=function(t){return this.applicationGridService.selectAll(t)},t.prototype.unselectAll=function(t){return this.applicationGridService.unselectAll(t)},t}();